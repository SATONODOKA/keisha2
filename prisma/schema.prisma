datasource db {
  provider = "sqlite"
  url = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  EXEC      // 役員
  MANAGER   // 部長/課長
  SENIOR    // 主任/リーダー
  MEMBER    // 一般（既定）
  JUNIOR    // 新人/インターン
}

model Group {
  id            String   @id @default(cuid())
  key           String   @unique         // URLキー（12〜16文字の英数記号なし）
  name          String
  roundingUnit  Int      @default(1)    // 1 | 10 | 100 | 1000
  members       Member[]
  expenses      Expense[]
  createdAt     DateTime @default(now())
}

model Member {
  id        String   @id @default(cuid())
  groupId   String
  group     Group    @relation(fields: [groupId], references: [id])
  name      String
  isActive  Boolean  @default(true)
  role      Role     @default(MEMBER) // 追加：既存は自動で MEMBER
  age       Int?                      // 追加：nullable（未入力可）
  createdAt DateTime @default(now())
  
  // リレーションシップの逆参照
  paidExpenses Expense[] @relation("PaidByMember")
  beneficiaries Beneficiary[]
}

model Expense {
  id        String   @id @default(cuid())
  groupId   String
  group     Group    @relation(fields: [groupId], references: [id])
  title     String
  amountYen Int      // 円単位の整数（内部は常に整数）
  paidById  String
  paidBy    Member   @relation("PaidByMember", fields: [paidById], references: [id])
  items     Beneficiary[]
  createdAt DateTime @default(now())
}

model Beneficiary {
  expenseId String
  expense   Expense  @relation(fields: [expenseId], references: [id])
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id])

  @@id([expenseId, memberId])
}
